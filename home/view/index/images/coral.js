document.domain="qq.com";var v_201308071037;
(function(a,h,k){function q(a){return a}function p(a){return decodeURIComponent(a.replace(n," "))}var n=/\+/g,b=a.cookie=function(c,d,e){if(d!==k){e=a.extend({},b.defaults,e);null===d&&(e.expires=-1);if("number"===typeof e.expires){var f=e.expires,l=e.expires=new Date;l.setDate(l.getDate()+f)}d=b.json?JSON.stringify(d):String(d);return h.cookie=[encodeURIComponent(c),"=",b.raw?d:encodeURIComponent(d),e.expires?"; expires="+e.expires.toUTCString():"",e.path?"; path="+e.path:"",e.domain?"; domain="+
e.domain:"",e.secure?"; secure":""].join("")}d=b.raw?q:p;e=h.cookie.split("; ");for(f=0;l=e[f]&&e[f].split("=");f++)if(d(l.shift())===c)return c=d(l.join("=")),b.json?JSON.parse(c):c;return null};b.defaults={domain:"qq.com",path:"/",expires:7};a.removeCookie=function(b,d){return null!==a.cookie(b)?(a.cookie(b,null,d),!0):!1}})(jQuery,document);
(function(a,h,k,q){var p,n,b="onfocusin"in h&&"hasFocus"in h?"focusin focusout":"focus blur",c=["","moz","ms","o","webkit"],d=k.support,e=k.event;for(;(n=p=c.pop())!=q;)if(n=(p?p+"H":"h")+"idden",d.pageVisibility="boolean"==typeof h[n]){b=p+"visibilitychange";break}k(/blur$/.test(b)?a:h).bind(b,function(a){var b=a.type;a=a.originalEvent;var c=a.toElement;(!/^focus./.test(b)||c==q&&a.fromElement==q&&a.relatedTarget==q)&&e.trigger((n&&h[n]||/^(?:blur|focusout)$/.test(b)?"hide":"show")+".visibility")})})(this,
document,jQuery);"undefined"!=typeof $&&($.noConflict&&"object"!=typeof jQuery)&&$.noConflict();
jQuery(document).ready(function(){(function(a){var h=a(document),k=a(window),q=a("body"),p=null,n=(location.protocol+"//"+location.host+location.pathname).match(/https?:\/\/([^\.]+)/)[1];a.widget("qq.comment",{options:{dataSource0:"",$content:a("#content"),$loginBtns:a("#loginBtn"),$loginTrigger:a("#onekey"),$logoutTrigger:a("#loginOut"),loginEvent:"logined",$popReply:a("#public_reply"),$topReply:a("#top_reply"),$topContent:a("#top_content"),$popContent:a("#pop_content"),$allComments:a("#allComments"),
$showNum:a("#showNum"),$postBtns:a("#top_post_btn,#pop_post_btn"),$commentTotleNum:a("#commentTotleNum"),$loadMore:a("#loadMore"),toggleEvent:"toggle",fetchUrl:"http://coral.qq.com/",wfetchUrl:"http://coral.qq.com/",topCallback:"top.topCallback",popCallback:"top.popCallback",$popObj:a("#popObj"),$allCons:a("#tab1_allComments"),$myComments:a("#tab2_myComments"),$tips:a("#tab3_tips"),$mycon:a("#tab4_mycon"),$loginFlag:a("#loginFlag"),$myCowComment:a("#myCowComment"),$myAllComment:a("#myAllComment"),
$tabFlag:!0,$realtimeComments:0,$targetId:"",$insertFlag:"comment",$nowDate:new Date,$urlapi:{userId:0,first:"",last:"",msgid:"",pageflag:0},$urlapi_mycomment:{userId:0,first:"",last:"",msgid:"",pageflag:0},$urlapi_userComment:{userId:0,first:"",last:"",msgid:"",pageflag:0},loginuin:0,pubSucEvent:"commentpubsuccess",topContentTips:"",homePageSize:10,centerPageSize:10,loadPageSize:20,newsNum:0},_create:function(){var a=this;this.changeTab();this.creatMask();this.getTargetId();this.onScriptLoad();this.bindLoginButtonsClick();
this.bindSubmitEvent();this.bindFooterEvent(this.options.$content);this.bindOtherEvents();this.makeCommentList();this.tabsComment();this.clickLoadMore();this.sendStat(n);this.element.bind(this.options.loginEvent,function(c,d,e,f){a.onLogined(d,e,f)});this.element.bind(this.options.pubSucEvent,function(c,d){a.insertTempComment(d.data.commentid,d.data.content,d.data.parent,d.data.time,d.data.checktype);a.options.$urlapi_mycomment.msgid=a.options.$urlapi_mycomment.first;a.loadMyComment();a.updateTime()})},
creatMask:function(){this.options.$targetId=cmt_id;0==q.find("#maskObj").length&&a("body").append('<div id="maskObj" class="maskObj"></div>');a("#loadMsgMore").append('<em style="display:none; background:#ccc;"></em>');a("#loadCmtMore").append('<em style="display:none; background:#ccc;"></em>');a("#loadPopInfo").append('<em style="display:none; background:#ccc;"></em>');a("#loadMore").append('<em style="display:none; background:#ccc;"></em>')},getTargetId:function(){window.ARTICLE_INFO||(window.ARTICLE_INFO=
{});window.ARTICLE_INFO.targetid=cmt_id},creatHmtl:function(a,c,d){var e=a.userinfo?a.userinfo.head:"http://mat1.gtimg.com/news/dc/images/user.png",f=a.userinfo.nick,l=a.content.replace(/ /g,"&nbsp;"),l=l.replace(/\n/g,"<br />");a.userinfo.region.replace(/:/g," ");var g="",r="comment_";"msg"==d&&(r="msg_",g="");"top"==d&&(r="top_",g="topIco");d="";var m="popClick";2==a.checkstatus&&0<a.rep?(d="Occupy",e="http://mat1.gtimg.com/news/dc/images/user.png",f="\u817e\u8baf\u7f51\u53cb",l='<span class="s">\u6b63\u5728\u5ba1\u6838\u4e2d...</span>',
m=""):d=2==a.checkstatus&&0>=a.rep?"hide":"";return a=""+("<li class='post "+(c?c:"")+" "+g+" "+d+"' id="+r+a.id+"><div class='post-content'><div class='indicator'></div><div class='avatar "+m+"' post_uid = '"+a.userinfo.userid+"'><span><img src='"+e+"'/></span></div><div class='post-body'><div class='post-header'><span   post_uid = "+a.userinfo.userid+" class='publisher "+m+"'>"+f+"</span>"+(0==a.parent?"<span class='replywho' style='display:none'>\u56de\u590d\u4e86  "+a.replyuser+"</span>":"<span class='replywho'>"+
a.replyuser+"</span>")+"<span date="+a.time+" class='uptime'>"+this.formatTime(a.time)+"</span></div><div class='post-message-container'><div>"+l+"</div></div><div class='post-footer'><em class='newcoment' id=em_"+a.id+"></em><span class='upvote'><a href='javascript:void(0)'><i>\u9876</i>(<em>"+a.up+"</em>)</a></span><span class='reply'><a href='javascript:void(0)'>\u56de\u590d</a></span></div></div></div><ul class='children'></ul></li>")},makeCommentList:function(){var b=this,c=this.options;c.$commentTotleNum.parent("a").attr("href",
"http://coral.qq.com/"+ARTICLE_INFO.targetid);a("#cmtNum").attr({href:"http://coral.qq.com/"+ARTICLE_INFO.targetid,target:"_blank"});b.loadMore();c.$loadMore.find("span").bind("click",function(){a("#loadMore>span").hide();a("#loadMore>em").css("display","block").html("\u52a0\u8f7d\u4e2d...");var d=a("#allComments li:last").attr("id").split("_")[1];b.loadMore(d);0>=c.$loadMore.data("loadMoreNume")-c.homePageSize?(c.$loadMore.hide(),c.$loadMore.data("loadMoreNume",0)):c.$loadMore.data("loadMoreNume",
c.$loadMore.data("loadMoreNume")-c.homePageSize);sendClientStat(n,1,cmt_id,"clk_allcomment_more")})},makeHotList:function(){var b=this;a.ajax({url:this.options.fetchUrl+"article/"+ARTICLE_INFO.targetid+"/hotcomment?reqnum=3&source=1",dataType:"jsonp",beforeSend:function(){b._hotTimer0=(new Date).getTime()},success:function(c){if(0==c.errCode){var d=(new Date).getTime(),e=c.data.commentid.length;a.each(c.data.commentid,function(d,l){a("#allComments .post-list").prepend(b.creatHmtl(c.data.commentid[e-
d-1],0,"top"))})}Qoss("zrpl",b._hotTimer0,{1:b._hotTimer0+1,2:d,3:d},100)}})},tabsComment:function(){var b=this.options,c=function(b,c,d,e){b.bind("click",function(){a(this).addClass("on");c.removeClass("on");d.show();e.hide()});c.bind("click",function(){a(this).addClass("on");b.removeClass("on");d.hide();e.show()})},d=b.$content.find("div.main_titleTab").find("span.tab1"),e=b.$content.find("div.main_titleTab").find("span.tab2"),f=b.$content.find("div.chid_titleTab").find("span.tab1"),l=b.$content.find("div.chid_titleTab").find("span.tab2");
c(d,e,b.$allCons,b.$myComments);c(f,l,b.$tips,b.$mycon)},loadMore:function(b){function c(){0==a("#allComments li").length&&a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show();a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>")}var d=this,e=this.options;b=b||0;var f=e.homePageSize;b&&(f=20);a.ajax({url:e.fetchUrl+"article/"+ARTICLE_INFO.targetid+"/comment?commentid="+b+"&reqnum="+f+"&source=1",dataType:"jsonp",
beforeSend:function(){d._latestTimer0=(new Date).getTime()},error:c,success:function(g){if(0==g.errCode){var f=(new Date).getTime();g.data.retnum<g.data.reqnum||10>=g.data.total?(a("#loadMore>span").hide(),a("#loadMore>em").css("display","block").html("\u6ca1\u6709\u66f4\u591a\u4e86")):(a("#loadMore").show(),a("#loadMore>em").hide(),a("#loadMore>span").css("display","block"));e.$showNum.data("maxID",g.data.maxid);l(g);b||(g.data.reqnum<g.data.total&&e.$loadMore.show(),d.probeEvent(),e.$commentTotleNum.html("<span>"+
g.data.total+"</span>\u6761\u8bc4\u8bba"),a("#cmtNum")&&a("#cmtNum").html(g.data.total),a("#cmtNum2")&&a("#cmtNum2").html(g.data.total),d.makeHotList())}else c();Qoss("zxpl",d._latestTimer0,{1:d._latestTimer0+1,2:f,3:f},100)}});var l=function(b){b.data.commentid.length||0!=a("#allComments li").length?a("#allComments").children(".tipInfo").hide():a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show();a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>");
a.each(b.data.commentid,function(b,c){0==c.parent?a("#allComments .post-list").append(d.creatHmtl(c)):a("#comment_"+c.parent+">ul.children").append(d.creatHmtl(c))});d.conHeight()}},blueLine:function(b){setTimeout(function(){a(b+">.post-content>.indicator").animate({opacity:"0"},1E4);setTimeout(function(){a(b+">.post-content>.avatar").animate({left:"0px"},400);a(b+">.post-content>.post-body").animate({"padding-left":"10px"},400);a(b).removeClass("blueflag")},8E3)},5E3)},probeEvent:function(){var b=
this,c=this.options,d=function(){c.$tabFlag?(a.ajax({url:"http://sync.coral.qq.com/t/"+ARTICLE_INFO.targetid+"?source=1",dataType:"jsonp",jsonpCallback:"probeuEvent",success:function(a){a>c.$realtimeComments&&0!=a&&(c.$realtimeComments=a,b.loadNew());setTimeout(function(){d()},3E4)},error:function(){setTimeout(function(){d()},3E4)}}),0!=b.getLoginStatus()&&b.loadNum()):setTimeout(function(){d()},3E4);b.updateTime()};d()},loadNew:function(){var b=this,c=this.options,d=function(){c.$tabFlag&&a.ajax({url:c.fetchUrl+
"article/"+ARTICLE_INFO.targetid+"/sync?lastid="+c.$showNum.data("maxID")+"&source=1",dataType:"jsonp",timeout:3E4,success:function(d){b.options.$nowDate=1E3*d.info.time;if(0==d.errCode&&0!=d.data.length){d.data.maxid&&c.$showNum.data("maxID",d.data.maxid);a.each(d.data.commentid,function(d,e){if(2!=e.checkstatus){var g=c.$commentTotleNum.children("span").html();c.$commentTotleNum.children("span").html(parseInt(g)+1);a("#cmtNum")&&a("#cmtNum").html(parseInt(g)+1);a("#cmtNum2")&&a("#cmtNum2").html(parseInt(g)+
1)}0==e.parent?e.userinfo.userid!=a.cookie("uid")&&(a("#hiddenCon").prepend(b.creatHmtl(e)),g=a("#hiddenCon li"),a.each(g,function(b,c){a(c).addClass("blueflag")})):a.each(c.$allComments.find("li"),function(c,d){if(e.userinfo.userid!=a.cookie("uid")&&"comment_"+e.parent==d.id){void 0==a("#"+d.id).data("num")&&a("#"+d.id).data("num",0);if(a("#comment_"+e.parent).hasClass("undis")){var g=a("#comment_"+e.parent).parents("li:not(.undis):first");g.data("num",Number(g.data("num"))+1);var f=g.data("num")+
"\u6761\u65b0\u56de\u590d",g=g.find(".post-footer:first>em.newcoment")}else a("#"+d.id).data("num",Number(a("#"+d.id).data("num"))+1),f=a("#"+d.id).data("num")+"\u6761\u65b0\u56de\u590d",g=a(this).find(".post-footer:first>em.newcoment");g.html(f);g.show();a(d).find("ul:first").prepend(b.creatHmtl(e,"undis"))}});a("#hiddenCon").html()&&e.parent&&(g=a("#hiddenCon li"),a.each(g,function(c,d){"comment_"+e.parent==d.id&&a(d).children(".children").append(b.creatHmtl(e))}))});if(d=a("#hiddenCon li").not(a(".hide")).length)a("#showNum span").html("<em>"+
d+"</em> \u6761\u65b0\u8bc4\u8bba"),a("#showNum").show().animate({height:"30px"},"slow");a("#showNum").unbind().bind("click",function(){a("#allComments ul:first").prepend(a("#hiddenCon").html());a("#hiddenCon .blueflag").each(function(c,d){var e=a(this).attr("id");b.blueLine("#"+e)});a("#allComments li.temporary").remove();a("#hiddenCon").html("");a(this).hide();c.newsNum=0;sendClientStat(n,1,cmt_id,"clk_newcomment_notice")})}b.updateTime()},error:function(a,b,c){"timeout"==b&&setTimeout(function(){d()},
5E3)}})};d()},changeTab:function(){var b=this.options;a(document).bind({"show.visibility":function(){b.$tabFlag=!0},"hide.visibility":function(){b.$tabFlag=!1}})},loadNum:function(){var b=a.cookie("uid"),c="http://sync.coral.qq.com/u/"+b+"?source=1";/^\d+$/.test(b+"")&&a.ajax({url:c,dataType:"jsonp",jsonpCallback:"probeuNum",beforeSend:function(){},success:function(b){0<b?(a("#myCowComment em").html(b),a("#myCowComment em").show()):a("#popMsg").html("").hide()}})},bindFooterEvent:function(b){var c=
this,d=this.options,e=a(".pop_reply"),f=a(".pop_reply a.submit"),l=a(".pop_reply textarea");b.delegate(".reply","click",function(c){c=c||window.event;var r=a(this).parents("li.post").attr("id");f.attr("id","pop_"+r);l.attr("id","pop_text_"+r);var m=a(this).closest(".post-content").next(".children");m.find(".replyBtn a").removeClass("submitOn").addClass("submit").html("\u56de\u590d");m.find("textarea").val("");c.stopPropagation();if(a("#commentArea").hasClass("on")&&d.$topContent.val()==d.topContentTips||
0>=d.$topContent.val().length)a("#commentArea").removeClass("on"),0>=d.$topContent.val().length&&d.$topContent.val(d.topContentTips);m.has(".pop_reply").length&&"pop_reply"==m.children().first().attr("class")?m.children(".pop_reply").is(":visible")?m.children(".pop_reply").slideUp("10"):(m.children(".pop_reply").slideDown("100"),setTimeout(function(){m.children(".pop_reply").find("textarea").focus()},200)):(b.find(".pop_reply").slideUp("10",function(){a(this).remove()}),m.prepend(e.clone()),m.find(".replyBtn a.cancel").remove(),
m.children(".pop_reply").slideDown("100"),setTimeout(function(){m.children(".pop_reply").find("textarea").focus()},200))});b.delegate(".pop_reply","click",function(a){a.stopPropagation()});b.delegate(".submit","click",function(){var b=c.getLoginStatus(),e=a(this).parents(".post").attr("tid");0!=b?(c.checkAndPublish(this.id,e),d.$insertFlag=this.id.split("_")[1],sendClientStat(n,1,cmt_id,"pub_reply")):d.$loginBtns.first().click()});b.delegate(".pop_user_login","click",function(){c.showLoginLayer()});
a("#my-notification").delegate(".upvote","click",function(){alert("\u81ea\u5df1\u4e0d\u80fd\u9876\u81ea\u5df1");return!1});b.delegate(".upvote","click",function(){var b=a(this).parent(".post-footer").children("em.newcoment").attr("id").split("_")[1];if(a(this).find("a").hasClass("hasup")||a(this).find("span").hasClass("hasup"))return!1;if(a.cookie("uid")==a(this).parent().parent().prev(".avatar").attr("post_uid"))return alert("\u81ea\u5df1\u4e0d\u80fd\u9876\u81ea\u5df1"),!1;a.ajax({url:d.wfetchUrl+
"article/comment/up/to/"+b+"?targetid="+ARTICLE_INFO.targetid+"&source=1",dataType:"jsonp",cache:!0,beforeSend:function(){},success:function(a){sendClientStat(n,1,cmt_id,"pub_up")}});var b=a(this).find("em"),c=parseInt(b.text());b.html(c+1);a(this).find("a").addClass("hasup");a(this).find("span").addClass("hasup");a(this).find("i").html("\u5df2\u9876")});b.delegate(".popClick","click",function(){var b={uid:a(this).attr("post_uid")};d.$urlapi_userComment.msgid="";c.popupLayer(b);sendClientStat(n,1,
cmt_id,"clk_head")});b.delegate(".newcoment","click",function(){var b=a(this).attr("id").split("_")[1];a("#comment_"+b+">ul.children li .newcoment").hide();a("#comment_"+b+">ul.children li.undis").removeClass("undis").addClass("blueflag");a(this).hide();a("#comment_"+b).data("num",0);a("#comment_"+b+">ul.children li.blueflag").each(function(b,d){c.blueLine("#"+a(this).attr("id"))});sendClientStat(n,1,cmt_id,"clk_newreply_notice")});b.delegate(".spreadMoreBtn","click",function(){var b=a(this).prev().children("div").height();
a(this).prev().animate({height:b},100);a(this).hide()});a("#popContent").delegate(".spreadMoreBtn","click",function(){var b=a(this).prev().children("div").height();a(this).prev().animate({height:b},100);a(this).hide()})},showLoginLayer:function(){this.options.$loginTrigger.click()},onLogined:function(b,c,d){var e=this.options;p=b||getUin();b="";b='<span class="myPic"><img width="35" height="35" src="'+(d?d:"http://mat1.gtimg.com/news/dc/images/user.png")+'" onerror="this.src=\'http://mat1.gtimg.com/news/dc/images/user.png\'"></span><span class="myName">'+
c+'</span><span class="change">\u5207\u6362\u5e10\u6237</span>';a(".pop_user_login").hide();this.options.$loginFlag.data("userPic",d);this.options.$loginFlag.html(b).show();a("#my-message-list").html("");a("#my-notification-list").html("");this.options.$loginBtns.hide();this.options.loginuin&&this.options.$topContent.focus();e.$urlapi_mycomment.msgid="";e.$urlapi.pageflag="0";e.$urlapi_mycomment.pageflag="0";e.$urlapi_userComment.pageflag="0";this.loadMyMessage();this.loadMyComment();a("#my-message .tipInfo").show()},
loginOut:function(b){var c=this.options;p=null;b||this.options.$logoutTrigger.click();a(".pop_user_info").hide();a(".pop_user_login").show();c.$loginFlag.hide();c.$loginBtns.show();c.$myAllComment.trigger("click");a("#top_post_btn").hide();a("#top_post_btn_login").show()},bindLoginButtonsClick:function(){var a=this;this.options.$loginBtns.click(function(){a.showLoginLayer()})},getLoginStatus:function(){if(p!=getUin())try{this.logout()}catch(a){}return p?1:0},bindSubmitEvent:function(){var a=this,
c=this.options;c.$postBtns.unbind().click(function(){a.checkAndPublish(this.id);c.$insertFlag="comment"})},checkAndPublish:function(b,c){var d=this.options,e=b.replace(/pop/,"pop_text"),e=a("#"+e),f=b.split("_")[0];"top"==f&&(e=d.$topContent,sendClientStat(n,1,cmt_id,"pub_original"));0==a.trim(e.val()).length||e.val()==d.topContentTips?this.pubCallback(b,{ret:1,error2show:"\u8bf7\u8f93\u5165\u5185\u5bb9\uff01"}):2E3<a.trim(e.val()).realLength()?alert("\u8d85\u8fc71000\u4e2a\u5b57\u4e86"):getUin()?
("top"==f&&(a("#top_post_btn_load").show(),a("#top_post_btn").hide()),this.postData(b,c)):d.$loginBtns.first().click()},postData:function(b,c){var d=this.options;this._pubTimer0=(new Date).getTime();var e=generateToken(getKey()),f=b.replace(/pop/,"pop_text"),l=b.split("_")[2],g=b.split("_")[0],r=0,r="Netscape"==navigator.appName?"UTF-8"!=document.characterSet?1:0:"UTF-8"!=document.charset.toUpperCase()?1:0;"top"==g?this.submitForm({targetid:ARTICLE_INFO.targetid,type:1,format:"SCRIPT",callback:d.topCallback,
content:a.trim(d.$topContent.val()),_method:"put",g_tk:e,code:r,source:1}):"pop"==g&&(a("#"+b).html("").removeClass("submit").addClass("submitOn"),this.submitForm({targetid:c||ARTICLE_INFO.targetid,type:1,format:"SCRIPT",callback:d.popCallback,content:a.trim(a("#"+f).val()),_method:"put",g_tk:e,code:r,source:1},l))},sendStat:function(a){sendClientStat(n,2,cmt_id,"coral"==a?"pgv_commentdetail":"pgv_articledetail")},submitForm:function(b,c){var d=this.options,e="",e=c?d.wfetchUrl+"article/comment/to/"+
c:d.wfetchUrl+"article/comment/";a("#post_iframe").length||q.append('<iframe id="post_iframe" name="post_iframe" style="display:none"><script type="text/javascript">document.domain = "qq.com";\x3c/script></iframe>');d=a("#_messageform").length?a("#_messageform").attr("action",e).empty():a('<form action="'+e+'" method="post" target="post_iframe" id="_messageform" style="display:none;"></form>').appendTo(q);for(name in b)d.append(a('<input name="'+name+'" type="hidden" value="" />').val(b[name]));d.submit()},
pubCallback:function(b,c,d){var e=b.split("_")[0],f=this.options,l="\u8bc4\u8bba\u6210\u529f\uff01 ",g=!0;if("top"==e)c.ret?(l=c.error2show||"<b>\u56e7</b>... \u51fa\u9519\u4e86\uff01 ",g=!1,setTimeout(function(){f.$topContent.focus();f.$topReply.find("span.tips").html(l).fadeOut("fast")},2E3)):(a("#top_post_btn_load").hide(),a("#top_post_btn").show(),this._trigger("pubsuccess",null,c)),f.$topReply.find("span.tips").html(l).fadeIn("fast"),g&&(f.$topContent.val(""),setTimeout(function(){f.$topReply.find("span.tips").hide();
f.$topReply.find("span.fontsline").show();f.$topContent.focus()},2E3));else if(c.ret){var r=a("#"+b).parent().children(".tips"),m=b.replace(/pop/,"pop_text"),l=c.error2show||"<b>\u56e7</b>... \u51fa\u9519\u4e86\uff01 ";r.html(l).show();setTimeout(function(){a("#"+m).focus();r.html("")},2E3)}else this._trigger("pubsuccess",null,c);d&&Qoss("hfpljk",this._pubTimer0,{1:this._pubTimer0+1,2:d,3:d})},insertTempComment:function(b,c,d,e,f){var l=this.options;p||getUin();var g=this.options.$loginFlag.data("nick"),
r=this.options.$loginFlag.data("userPic"),m="";1==f?(c={id:b,parent:0,time:e,content:c,up:0,userinfo:{userid:a.cookie("uid"),commentnum:"",upnum:0,nick:g,head:r,region:""}},m=this.creatHmtl(c,"blueflag",l.$insertFlag),this.blueLine("#"+l.$insertFlag+"_"+b)):m="<li class='post temporary' id=comment_"+b+"><div class='post-content'><div class='avatar'><span><img src='"+r+"'/></span></div><div class='post-body'><div class='post-header'><span class='publisher'><span>"+g+"</span></span><span class='uptime0'>\u521a\u521a</span><span class='wait'>\u6b63\u5728\u5ba1\u6838...</span></div><div class='post-message-container'><div>"+
c+"</div></div><div class='post-footer' style='height:5px'><em></em></div></div></div><ul class='children'></ul></li>";if(0!=parseInt(d)){if(a("#top_"+d).length||a("#comment_"+d).length||a("#post_"+d).length||a("#msg_"+d).length)a("#top_"+d+">ul.children").prepend(m).children("div.pop_reply").hide(),a("#comment_"+d+">ul.children").prepend(m).children("div.pop_reply").hide(),a("#post_"+d+">ul.children").children("div.pop_reply").hide(),a("#msg_"+d+">ul.children").prepend(m).children("div.pop_reply").hide()}else a("#allComments .tipInfo:visible")&&
a("#allComments .tipInfo").hide(),this.options.$allComments.children("ul.post-list").prepend(m)},popupLayer:function(b){var c=this.options,d=h.height()>k.height()?h.height():k.height();c.$urlapi_userComment.userId=b.uid;if(c.$urlapi.userId=b.uid)a("#popInfo").html(""),this.loadUserComment();a("#loadPopInfo").hide();a("#loadPopInfo>span").css("display","block");a("#popObj .userPic").find("img").attr("src","http://mat1.gtimg.com/news/dc/images/user.png");a("#parent").hide();a("#div1").css("top","0px");
a("#div3").css("top","0px");var e=function(){a("#popContent").height(c.$popObj.height()-120);a("#popContent .popInner").height(c.$popObj.height()-140);a("#div2").height(a("#popContent .popInner").height());a("#parent").height(a("#popContent .popInner").height());a("#div1").css("height",a("#parent").height()*a("#div2").height()/a("#div3").height());a("#div1").css("top","0px");a("#div3").css("top","0px")};!a.browser.msie||("6.0"!=a.browser.version&&"7.0"!=a.browser.version||a.support.style)||(c.$popObj.css("top",
k.scrollTop()+0.1*k.height()),c.$popObj.css("top")>k.height()&&c.$popObj.hide(),780>c.$popObj.height()?c.$popObj.height(0.8*k.height()):c.$popObj.height(780),a("#popContent").height(0.8*k.height()-120),k.resize(function(){c.$popObj.height(0.8*k.height())}),k.scroll(function(){c.$popObj.css("top",k.scrollTop()+0.1*k.height())}),e());e();k.resize(function(){e()});var f=function(){a.browser.msie&&"6.0"==a.browser.version&&!a.support.style?c.$popObj.stop().animate({top:k.scrollTop()+k.height()},300).show():
c.$popObj.stop().animate({top:"100%"},300);q.css("overflow","");a("html").css("overflow","auto");setTimeout(function(){c.$popObj.hide()},301);a("#maskObj").hide();a("#loadPopInfo").hide()};q.css("overflow","hidden");a("html").css("overflow","hidden");a("#maskObj").height(d).show();a.browser.msie&&"6.0"==a.browser.version&&!a.support.style?c.$popObj.stop().animate({top:k.scrollTop()+0.1*k.height()},300).show():c.$popObj.stop().animate({top:"10%"},300).show();a("#maskObj").unbind().click(function(){f()});
c.$popObj.find(".close").unbind().click(function(){f()});this.popScroll()},popScroll:function(){function b(a){var b=!0,b=a.originalEvent.wheelDelta?0>a.originalEvent.wheelDelta:0<a.originalEvent.detail,r=0;if(b)if(e.height()>d.height())r=e.position().top-20;else return;else if(e.height()>d.height())r=e.position().top+20;else return;b=r;0>-b?b=0:-b>e.height()-d.height()&&(b=-(e.height()-d.height()));e.css("top",b);b=-b/(e.height()-d.height());c.css("top",(f.height()-c.height())*b);a.preventDefault&&
a.preventDefault()}var c=a("#div1"),d=a("#div2"),e=a("#div3"),f=a("#parent");f.bind("mousewheel",function(a){b(a)});f.bind("DOMMouseScroll",function(a){b(a)});e.bind("mousewheel",function(a){b(a)});e.bind("DOMMouseScroll",function(a){b(a)});c.bind("mousedown",function(a){a=a||window.event;var b=a.clientY-c.position().top;h.bind("mousemove",function(a){a=a||window.event;a=a.clientY-b;0>a?a=0:a>f.height()-c.height()&&(a=f.height()-c.height());c.css("top",a);a/=f.height()-c.height();e.css("top",-(e.height()-
d.height())*a)});h.bind("mouseup",function(a){h.unbind("mousemove");h.unbind("mouseup")});h.bind("selectstart",function(a){return!1})});h.bind("mouseup",function(a){h.unbind("selectstart")})},onScriptLoad:function(){var b=this;if(window.loginAll&&"function"==typeof window.loginAll)var c=window.loginAll;window.loginAll=function(d){if(c&&"function"==typeof c&&(c(d),0==d.result)){var e=d.Face;d=d.nick;var f=f||getUin(),l=getKey();f&&l&&(b.options.$loginFlag.data("userPic",e),b.options.$loginFlag.data("nick",
d),b.onLogined(f,d,e),a("#top_post_btn").show(),a("#top_post_btn_login").hide())}};a("#loginOut").click(function(){jQuery(document).comment("loginOut",1)})},bindOtherEvents:function(){var b=this,c=this.options;c.$topContent.val(c.topContentTips);c.$topContent.focus(function(){a("#commentArea").addClass("on");clearTimeout(c.blurTimer);c.$topContent.val()==c.topContentTips&&c.$topContent.val("")});c.$topContent.blur(function(){});a("#commentArea").bind("click",function(b){a("#commentArea").addClass("on");
b.stopPropagation();c.$topContent.focus();a("#content").find(".pop_reply").slideUp("10",function(){this.remove()})});h.click(function(){if(a("#commentArea").hasClass("on")&&c.$topContent.val()==c.topContentTips||0>=c.$topContent.val().length)a("#commentArea").removeClass("on"),0>=c.$topContent.val().length&&c.$topContent.val(c.topContentTips)});c.$content.delegate("#myCowComment","click",function(){b.conHeight(2)});c.$content.delegate("#mycon","click",function(){b.conHeight(3)});a("#commentArea").delegate("span.change",
"click",function(){b.showLoginLayer()});a("#top_post_btn_login").bind("click",function(){b.showLoginLayer()});c.$myCowComment.bind("click",function(){0!=b.getLoginStatus()?(a("#my-message-list li").length&&b.conHeight(2),"none"!=a("#popMsg").css("display"))?(c.$urlapi.pageflag=2,a("#my-message .tipInfo").hide(),b.loadMyMessage(),a("#popMsg").html("").hide(),a("#mytips").trigger("click")):a(this).hasClass("on")?""==a("#popMsg").html()?0<=a("#my-message-list li").length||(a("#my-message-list").html(""),
b.loadMyMessage(),a("#popMsg").html("").hide()):(a("#my-message-list").html(""),b.loadMyMessage(),a("#popMsg").html("").hide()):(a(this).hasClass("on")?"none"!=a("#popMsg").css("display")&&(a("#my-message-list").html(""),b.loadMyMessage(),a("#popMsg").html("").hide()):a("#my-message-list li").length?"none"!=a("#popMsg").css("display")&&(a("#my-message-list").html(""),b.loadMyMessage(),a("#popMsg").html("").hide()):b.loadMyMessage(),0==a("#my-notification-list li").length&&b.loadMyComment(),b.checkAndPublish(this.id),
sendClientStat(n,1,cmt_id,"clk_myniuping")):(a("#my-message .tipInfo").hide(),a("#my-notification .tipInfo").hide(),c.$loginBtns.first().click())})},formatTime:function(a){var c=this.options.$nowDate/1E3-a;if(1>c)return"\u521a\u521a";if(60>c)return Math.floor(c)+"\u79d2\u949f\u524d";if(3600>c)return Math.floor(c/60)+"\u5206\u949f\u524d";if(86400>c)return Math.floor(c/3600)+"\u5c0f\u65f6\u524d";if(604800>c)return Math.floor(c/86400)+"\u5929\u524d";a=new Date(1E3*a);c=a.getFullYear()+"-";c+=a.getMonth()+
1+"-";return c+=a.getDate()},conHeight:function(b){var c=a(".post .post-message-container"),d=c.css("line-height").split("px")[0],d=d||24;2==b&&(c=a("#my-message-list .post .message-content"));3==b&&(c=a("#my-notification-list .post .message-content"));4==b&&(c=a("#popInfo .post .message-content"));c.each(function(b,c){a(this).height()>6*d&&!a(this).next(".spreadMoreBtn").length&&(a(this).css({height:5*d,overflow:"hidden"}),a(this).after('<div class="spreadMoreBtn"><span>\u5c55\u5f00</span></div>'))})},
updateTime:function(){var b=this;this.options.$content.find(".uptime").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});a("#my-message").find(".time").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});a("#my-notification").find(".post-time span").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});a("#hiddenCon").find(".uptime").each(function(){a(this).html(b.formatTime(a(this).attr("date")))})},subString:function(a,c){var d=/[^\x00-\xff]/g;if(a.replace(d,
"mm").length<=c)return a;for(var e=Math.floor(c/2);e<a.length;e++)if(a.substr(0,e).replace(d,"mm").length>=c)return a.substr(0,e)+"...";return a},myCreateHmtl:function(b,c,d){var e="",f="",l=!1,g=!1,h="",m="",k="",n="",q="msg_",p="",p="<div class='article-title'> <a target='_blank' href='"+(b.targetinfo?b.targetinfo.url:"")+"'>"+b.targetinfo.title+"</a> </div>";"message"==c&&(m=b.userinfo.head.replace(/140/,"40"),l="3"==b.tipstype,g="4"==b.tipstype,l&&(f=m||"http://t0.qlogo.cn/mbloghead/01676c4b10bbdb6f2618/50"),
g&&(f="http://mat1.gtimg.com/www/niuping2013/upico.jpg",0<b.userlist.length&&(a.each(b.userlist,function(a,b){0<a&&(h+="\u3001");h+="<span post_uid="+b.userid+" class='popClick'><strong>"+b.nick+"</strong></span>"}),b.userlist.length<b.up&&(h+="\u7b49"))),m="<div class='avatar "+(g?"":"popClick")+"' post_uid='"+b.userinfo.userid+"'><img src='"+f+"'></div>",k=l?"<strong post_uid='"+b.userinfo.userid+"' class='publisher popClick'>"+b.userinfo.nick+"</strong> \u56de\u590d\u4e86\u4f60\u7684\u8bc4\u8bba\uff1a<em class='title'>"+
this.subString(b.parentinfo.content,46)+"</em>":g?h+b.up+"\u4eba  \u9876\u4e86\u4f60\u7684\u8bc4\u8bba\uff1a<em class='title'>"+this.subString(b.content,46)+"</em> <span date='"+b.time+"' class='time'>"+this.formatTime(b.time)+"</span>":"");"myComment"==c&&(q="post_",n="(<em>"+b.repnum+"</em>)",m='<div class="post-time" ><span date=\''+b.time+"'>"+(b.time?this.formatTime(b.time):"\u521a\u521a")+"</span></div>",nick='<strong class="rename">'+b.userinfo.nick+"</strong>",a.cookie("uid")==b.userinfo.userid&&
(nick="\u6211"),b.parentinfo&&b.parentinfo.userinfo&&(nick2="<strong post_uid='"+b.parentinfo.userinfo.userid+'\' class="rename popClick">'+b.parentinfo.userinfo.nick+"</strong>",b.userinfo.userid==b.parentinfo.userinfo.userid&&(nick2="<strong>Ta</strong>"),a.cookie("uid")==b.parentinfo.userinfo.userid&&(nick2="\u6211")),k=b.parentinfo?nick+"\u56de\u590d\u4e86 "+nick2+" \u7684\u8bc4\u8bba\uff1a<em class='title'>"+this.subString(b.parentinfo.content,46)+"</em>":nick+"\u8bc4\u8bba\u4e86<a target='_blank' href=\""+
(b.targetinfo?b.targetinfo.url:"")+'">'+this.subString(b.targetinfo.title,46)+"</a>",b.parentinfo||(p=""));return e+="<li class='post "+d+"' id='"+q+""+b.id+"' tid='"+b.targetinfo.targetid+"'><div class='post-content'><div class='indicator'></div>"+m+"<div class='post-body'><div class='message-article'>"+k+"</div>"+(g?"":"<div class='message-content'><div>"+b.content.replace(/\n/g,"<br />")+"<span date='"+b.time+"' class='time'>"+(l?this.formatTime(b.time):"")+"</span></div></div>")+p+(g?"":"<div class='post-footer'><em class='newcoment' id='am_"+
b.id+"'></em><span class='upvote'><span><i>\u9876</i>(<em>"+b.up+"</em>)</span></span><span class='reply'  ><span>\u56de\u590d"+n+"</span></span></div>")+"</div></div><ul class='children'></ul></li>"},loadMyMessage:function(){var b=this,c=this.options,d=c.$urlapi,e="",f=c.centerPageSize;1==c.$urlapi.pageflag&&(f=20);a.ajax({url:c.fetchUrl+"user/"+c.$urlapi.userId+"/msg?msgid="+c.$urlapi.msgid+"&pageflag="+c.$urlapi.pageflag+"&reqnum="+f+"&source=1",dataType:"jsonp",beforeSend:function(){b._tips0=
(new Date).getTime()},success:function(f){var g=(new Date).getTime();if(8==f.errCode)c.$loginTrigger.click();else{if(0==f.errCode&&0<f.data.retnum){0==d.pageflag&&(d.msgid=d.first=f.data.first,d.last=f.data.last,a("#my-message-list").html(""));1==d.pageflag&&(d.msgid=d.last=f.data.last);var h="";2==d.pageflag&&(d.msgid=d.first=f.data.first,h="blueflag");a.each(f.data.message,function(a,c){e+=b.myCreateHmtl(c,"message",h)});1==c.$urlapi.pageflag?a("#my-message-list").append(e):(a("#my-message-list").prepend(e),
a("#my-message-list .blueflag").each(function(c,d){b.blueLine("#"+a(this).attr("id"))}));b.conHeight(2);f.data.retnum<c.centerPageSize||10>=f.data.total?(a("#loadMsgMore>span").hide(),a("#loadMsgMore>em").css("display","block").html("\u6ca1\u6709\u66f4\u591a\u4e86")):(a("#loadMsgMore").show(),a("#loadMsgMore>em").hide(),a("#loadMsgMore>span").css("display","block"));a("#my-message").children(".tipInfo").hide()}else 0==f.errCode&&0==f.data.retnum?0==a("#my-message-list li").length?a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show():
a("#my-message").children(".tipInfo").hide():a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show();Qoss("wdtx",b._tips0,{1:b._tips0+1,2:g,3:g},100)}}})},loadMyComment:function(){var b=this,c=this.options,d=c.centerPageSize;1==c.$urlapi_mycomment.pageflag&&(d=20);a.ajax({url:c.fetchUrl+"user/"+c.$urlapi_mycomment.userId+"/comment?lastid="+c.$urlapi_mycomment.msgid+"&pageflag="+c.$urlapi_mycomment.pageflag+"&reqnum="+d+"&source=1",dataType:"jsonp",beforeSend:function(){b._myCom0=
(new Date).getTime()},success:function(d){var f="";if(0==d.errCode&&0<d.data.retnum){if(c.$urlapi_mycomment.last==d.data.last)return;var h=(new Date).getTime();0==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.first=d.data.first,c.$urlapi_mycomment.last=d.data.last,a("#my-notification-list").html(""));1==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.last=d.data.last);2==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.first=
d.data.first);a.each(d.data.comments,function(a,c){f+=b.myCreateHmtl(c,"myComment")});a("#my-notification-list").append(f);b.conHeight(3);(d.data.total<=a("#my-notification-list>li").length||d.data.retnum<c.centerPageSize)&&a("#my-notification-list>li").length>=d.data.retnum?(a("#loadCmtMore>em").html("\u6ca1\u6709\u66f4\u591a\u4e86"),a("#loadCmtMore>span").hide()):(a("#loadCmtMore").show(),a("#loadCmtMore>span").css("display","block"),a("#loadCmtMore>em").hide());a("#my-notification").children(".tipInfo").hide()}else a("#my-notification").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show(),
0==a("#my-notification-list li").length&&a("#my-notification").children(".tipInfo").show();Qoss("wdpl",b._myCom0,{1:b._myCom0+1,2:h,3:h},100)}})},loadUserComment:function(){var b=this,c=this.options,d=c.$urlapi_userComment,e=c.centerPageSize;0==d.pageflag?d.msgid="":e=20;0==a("#popInfo li").length&&a("#my-notice").children(".tipInfo").removeClass("waitting").addClass("waitting").html("").show();a.ajax({url:c.fetchUrl+"user/"+d.userId+"/comment?lastid="+d.msgid+"&pageflag="+d.pageflag+"&reqnum="+e+
"&source=1",dataType:"jsonp",success:function(e){var h="";if(0==e.errCode){var g=e.data.usermeta,k=g.head.replace(/40/,"100"),m=g.region.replace(/:/g," ");a("#popObj .head .userPic").find("img").attr("src",k);a("#popObj .head .upvote i").html(g.upnum);a("#popObj .head .num i").html(g.commentnum);a("#popObj .head .upandnum strong").html(g.nick);a("#popObj .head .area").html(""!=a.trim(m)?m:"\u817e\u8baf\u7f51\u53cb")}0==e.errCode&&(0==e.data.comments.length&&0==a("#popInfo li").length?a("#my-notice").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show():
a("#my-notice").children(".tipInfo").hide(),0==d.pageflag&&e.data.first&&(d.msgid=d.first=e.data.first,d.last=e.data.last),1==d.pageflag&&e.data.last&&(d.msgid=d.last=e.data.last),2==d.pageflag&&e.data.first&&(d.msgid=d.first=e.data.first),a.each(e.data.comments,function(a,c){if(""!=c.content&&1==c.checkstatus||1==c.checktype&&0==c.checkstatus)h+=b.myCreateHmtl(c,"myComment")}),1==d.pageflag?a("#popInfo").append(h):a("#popInfo")[0].innerHTML=h,b.conHeight(4),0==a("#popInfo li").length&&a("#my-notice").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show(),
e.data.retnum<c.centerPageSize||10>=e.data.total?(a("#loadPopInfo>span").hide(),a("#loadPopInfo>em").css("display","block").html("\u6ca1\u6709\u66f4\u591a\u4e86")):(a("#loadPopInfo").show(),a("#loadPopInfo>em").hide(),a("#loadPopInfo>span").css("display","block")),a("#div3").height()<a("#div2").height()?a("#parent").hide():(a("#div1").css("height",a("#parent").height()*a("#div2").height()/a("#div3").height()),a("#parent").show()))}})},clickLoadMore:function(){var b=this,c=this.options;a("#loadMsgMore>span").click(function(){a("#loadMsgMore>span").hide();
a("#loadMsgMore>em").css("display","block").html("\u52a0\u8f7d\u4e2d...");c.$urlapi.pageflag=1;c.$urlapi.msgid=c.$urlapi.last;b.loadMyMessage();sendClientStat(n,1,cmt_id,"clk_notice_more")});a("#loadPopInfo>span").click(function(){a("#loadPopInfo>span").hide();a("#loadPopInfo>em").css("display","block").html("\u52a0\u8f7d\u4e2d...");c.$urlapi_userComment.pageflag=1;c.$urlapi_userComment.msgid=c.$urlapi_userComment.last;b.loadUserComment()});a("#loadCmtMore>span").click(function(){a("#loadCmtMore>span").hide();
a("#loadCmtMore>em").css("display","block").html("\u52a0\u8f7d\u4e2d...");c.$urlapi_mycomment.pageflag=1;c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.last;b.loadMyComment();sendClientStat(n,1,cmt_id,"clk_mycomment_more")})},isVisible:function(){return"webkitHidden"in document?!document.webkitHidden:"mozHidden"in document?!document.mozHidden:"hidden"in document?!document.hidden:!0}});h.comment()})(jQuery)});String.prototype.realLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length};
function topCallback(a){jQuery(document).comment("pubCallback","top",a,(new Date).getTime())}function popCallback(a){jQuery(document).comment("pubCallback","pop",a,(new Date).getTime())}function getUin(){var a=jQuery.cookie("uin")||jQuery.cookie("luin");return a&&a.match(/[1-9][0-9]*/)[0]}function getKey(){return jQuery.cookie("skey")||jQuery.cookie("lskey")}function generateToken(a){for(var h=2013,k=0,q=a.length;k<q;k++)h+=(h<<5)+a.charCodeAt(k);return h&2147483647}
function Qoss(a,h,k,q){if(!q||!parseInt(Math.random()*q)){for(var p in k)k[p]-=h;jQuery('<img src="http://qos.report.qq.com/collect?type=1&name=coral_qq_com_'+a+"&"+jQuery.param(k)+'">').error(function(){jQuery(this).remove()}).load(function(){jQuery(this).remove()}).appendTo("body")}}
function sendClientStat(a,h,k,q,p){var n=location.protocol+"//"+location.host+location.pathname,b=parseInt(1E9*Math.random()),c=getUin()||"",d=jQuery.cookie("uid"),e=encodeURIComponent(location.host);if("coral"==a)if(1==h){h=1836;var f="coral.web.comment_detail.action"}else h=1837,f="coral.web.comment_detail.pgv";else 1==h?(h=1836,f="coral.web.article_detail.action"):(h=1837,f="coral.web.article_detail.pgv");p=p||0;g_btrace_BOSS=new Image(1,1);g_btrace_BOSS.src="http://btrace.qq.com/collect?sIp=0&iQQ="+
c+"&sBiz="+f+"&sOp="+q+"&iSta="+p+"&iTy="+h+"&iFlow="+b+"&isite="+a+"&iTargetid="+k+"&iuid="+d+"&iUrl="+n+"&idomain="+e};/*  |xGv00|22599afe2e6ed1c99c276c31a4d14d84 */